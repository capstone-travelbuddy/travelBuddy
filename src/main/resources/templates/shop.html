<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/header">

    <meta charset="UTF-8">
    <title>Shop Page</title>

</head>
<body id="shop">
<nav th:insert="fragments/navbar"></nav>
<section class="pt-5 pb-5">
    <div class="container">
        <div class="row">
            <div class="col-6">
                <h3 th:text="${shop.name}" class="mb-3"></h3>
            </div>
            <div class="col-6 text-right">
                <a class="btn btn-primary mb-3 mr-1" href="#carouselExampleIndicators2" role="button" data-slide="prev">
                    <i class="fa fa-arrow-left"></i>
                </a>
                <a class="btn btn-primary mb-3 " href="#carouselExampleIndicators2" role="button" data-slide="next">
                    <i class="fa fa-arrow-right"></i>
                </a>
            </div>
            <div class="col-12">
                <div id="carouselExampleIndicators2" class="carousel slide" data-ride="carousel" th:each="image : ${shop.images}">

                    <div class="carousel-inner" style="height: 200px;">
                        <div class="carousel-item active">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">

                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">

                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">


                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">

                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <img class="img-fluid" alt="100%x280" th:src="@{'data:image/jpeg;base64,' + ${image.generateBase64Image()}}">

                                    </div>
                                </div>

                            </div>
<!--                        </div>-->
<!--                        <div class="carousel-item">-->
<!--                            <div class="row">-->

<!--                                <div class="col-md-4 mb-3">-->
<!--                                    <div class="card">-->
<!--                                        <img class="img-fluid" alt="100%x280" src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjMyMDc0fQ&amp;s=ee8417f0ea2a50d53a12665820b54e23">-->
<!--                                        <div class="card-body">-->
<!--                                            <h4 class="card-title">Special title treatment</h4>-->
<!--                                            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>-->

<!--                                        </div>-->

<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="col-md-4 mb-3">-->
<!--                                    <div class="card">-->
<!--                                        <img class="img-fluid" alt="100%x280" src="https://images.unsplash.com/photo-1532777946373-b6783242f211?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjMyMDc0fQ&amp;s=8ac55cf3a68785643998730839663129">-->
<!--                                        <div class="card-body">-->
<!--                                            <h4 class="card-title">Special title treatment</h4>-->
<!--                                            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>-->

<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="col-md-4 mb-3">-->
<!--                                    <div class="card">-->
<!--                                        <img class="img-fluid" alt="100%x280" src="https://images.unsplash.com/photo-1532763303805-529d595877c5?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjMyMDc0fQ&amp;s=5ee4fd5d19b40f93eadb21871757eda6">-->
<!--                                        <div class="card-body">-->
<!--                                            <h4 class="card-title">Special title treatment</h4>-->
<!--                                            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

    <div class="h1 text-success text-center" th:text="${add}"></div>
    <div class="h1 text-success text-center" th:text="${remove}"></div>

    <div class="m-5" th:text="${shop.name}" style="font-size: 24px; font-weight: 600; margin-left: -10px;"></div>
    <div class="m-5">
        <div sec:authorize="isAuthenticated()">
            <a th:href="'/create/review/shop/' + ${shop.id}">
                <button type="button" class="btn btn-primary btn-lg"><i class="fa fa-star" aria-hidden="true"></i>Write
                    A
                    Review
                </button>
            </a>
            <a th:href="'/shop/' + ${shop.id} + '/upload/'">
                <button type="button" class="btn btn-secondary btn-lg"><i class="fa fa-camera" aria-hidden="true"></i>
                    Add
                    Photo
                </button>
            </a>
            <a th:if="${user.getLikedShops().contains(shop)}" class="btn"
               th:href="'/like/shop/' + ${shop.id}">UNLIKE</a>
            <a th:if="${!user.getLikedShops().contains(shop)}" class="btn" th:href="'/like/shop/' + ${shop.id}">LIKE</a>
            <button th:attr="onclick=|add('${shop}')|" type="button" class="btn btn-secondary btn-lg">Save To Intineray
            </button>
        </div>
        <div class="container-fluid">
            <div class="col-sm-6  float-left" style="font-size: 12px; margin-left: -10px;">
                <br>
                <h1>Reviews</h1>
                <div th:each="review : ${shop.getReviews()}" class="comment mt-4 text-justify float-left">
                    <img th:src="@{'data:image/jpeg;base64,'+${review.getUser().getUserImage().generateBase64Image()}}"
                         alt="User Photo" class="rounded-circle" width="40" height="40"/>
                    <h4 th:text="${review.getUser().username}"></h4>
                    <div class="float-right">
                        <p th:if="${review.getRating() == 1}"><img class="Stars" th:src="@{/img/star.png}"></p>
                        <p th:if="${review.getRating() == 2}"><img class="Stars" th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"></p>
                        <p th:if="${review.getRating() == 3}"><img class="Stars" th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"><img class="Stars" th:src="@{/img/star.png}">
                        </p>
                        <p th:if="${review.getRating() == 4}"><img class="Stars" th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"><img class="Stars"
                                                                             th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"></p>
                        <p th:if="${review.getRating() == 5}"><img class="Stars" th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"><img class="Stars"
                                                                             th:src="@{/img/star.png}"><img
                                class="Stars" th:src="@{/img/star.png}"><img class="Stars" th:src="@{/img/star.png}">
                        </p>
                    </div>
                    <br>
                    <div class="float-right">
                        <h4 id="review date" th:text="${review.getCreated()}"></h4>
                    </div>
                    <br>
                    <p th:text="${review.getDescription()}"></p>
                </div>
            </div>
            <div class="card col-sm-6 float-right"
                 style="background-color: #c2c2c2; width: 40rem; height: 22rem; font-size: 20px; font-weight: 600; margin-top: -40px; margin-bottom: 20px;">
                <div class="card-header">
                    <a th:href="${shop.website}" role="link">Website</a>
                </div>
                <div class="card-header" style="margin-top: 5px;">
                    <p th:text="${shop.phoneNumber}"><i class="fa fa-phone fa-lg float-right"></i></p>
                </div>
                <div class="card-header">
                    <a href="##map" role="link">Get Directions:</a>
                    <p id="mark" th:text="${shop.address}"><i class="fa fa-directions fa-lg float-right"></i></p>
                </div>
                <div class="card-header">
                    <a th:href="${shop.socialURL}" role="link">Social Media</a>
                </div>
            </div>
            <br>
            <br>
            <div class="card col-sm-6 float-right" id="map" style="width: 40rem; height: 40rem;"></div>
            <input type="hidden" name="address" id="address" th:value="${shop.address}">

        </div>
    </div>
    <script src="mapbox-geocoder-utils.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>


    <script th:inline="javascript">

    var mark = document.getElementById('mark').innerText;


        /*<![CDATA[*/

        let key = /*[[${mapboxApiKey}]]*/ 'default';

        (function () {

        mapboxgl.accessToken = key;
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v9',
            center: [-98.4916, 29.4252],
            zoom: 10,
        });

        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true
        }));

            function geocode(search, token) {
                var baseUrl = 'https://api.mapbox.com';
                var endPoint = '/geocoding/v5/mapbox.places/';
                return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
                    .then(function(res) {
                        return res.json();
                        // to get all the data from the request, comment out the following three lines...
                    }).then(function(data) {
                        return data.features[0].center;
                    });
            }
            console.log(geocode(mark, key));
            geocode(mark,key).then(function(results){
                let marker = new mapboxgl.Marker();
                marker
                .setLngLat(results)
                .addTo(map)
            })

        })();

        /*]]>*/

    </script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
            integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2"
            crossorigin="anonymous"></script>

</body>

</html>